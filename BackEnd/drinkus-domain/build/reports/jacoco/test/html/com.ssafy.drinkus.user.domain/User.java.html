<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ko"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>User.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">drinkus-domain</a> &gt; <a href="index.source.html" class="el_package">com.ssafy.drinkus.user.domain</a> &gt; <span class="el_source">User.java</span></div><h1>User.java</h1><pre class="source lang-java linenums">package com.ssafy.drinkus.user.domain;

import com.ssafy.drinkus.common.BaseEntity;
import com.ssafy.drinkus.common.NicknameFailException;
import com.ssafy.drinkus.common.type.YN;
import com.ssafy.drinkus.room.domain.Room;
import com.ssafy.drinkus.room.domain.RoomHistory;
import com.ssafy.drinkus.user.domain.type.UserProvider;
import com.ssafy.drinkus.user.domain.type.UserRole;
import lombok.AccessLevel;
import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;

import javax.persistence.*;
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;
import org.json.JSONObject;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

@Entity
<span class="nc" id="L27">@NoArgsConstructor(access = AccessLevel.PROTECTED) // 무분별한 객체 생성에 대해 한번 더 체크할 수 있는 수단</span>
<span class="nc" id="L28">@AllArgsConstructor // 모든 생성자를 구현하는 annotation</span>
@Getter // JPA에서 lombok @Setter는 거의 쓰지 않습니다
public class User extends BaseEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = &quot;user_id&quot;)
<span class="nc" id="L35">    private Long userId;</span>

<span class="nc" id="L37">    private String userName;</span>

<span class="nc" id="L39">    private String userEmail;</span>

<span class="nc" id="L41">    private String userPw;</span>

<span class="nc" id="L43">    private String userFullname;</span>

<span class="nc" id="L45">    private String userNickname;</span>

<span class="nc" id="L47">    private Integer userPopularity;</span>

<span class="nc" id="L49">    private Integer userPopularityLimit; // 5 -&gt; 0</span>

<span class="nc" id="L51">    private String userBirthday;</span>

<span class="nc" id="L53">    private String userIntroduce;</span>

<span class="nc" id="L55">    private String userImg;</span>

<span class="nc" id="L57">    private LocalDateTime userDeleteDate;</span>

    @Enumerated(EnumType.STRING)
<span class="nc" id="L60">    private YN userDeleted; // Boolean type을 YN enum으로 사용</span>

    @Enumerated(EnumType.STRING)
<span class="nc" id="L63">    private UserRole userRole;</span>

    @Enumerated(EnumType.STRING)
<span class="nc" id="L66">    private UserProvider userProvider;</span>

<span class="nc" id="L68">    private String userProviderId;</span>

<span class="nc" id="L70">    private String userGrade;</span>

<span class="nc" id="L72">    private Long userPoint;</span>

<span class="nc" id="L74">    private LocalDateTime userStopDate; // 정지기한 -&gt; 추가기능</span>

<span class="nc" id="L76">    private Integer userSoju;</span>

<span class="nc" id="L78">    private Integer userBeer;</span>

<span class="nc" id="L80">    @OneToMany(mappedBy = &quot;user&quot;)</span>
<span class="nc" id="L81">    private List&lt;RoomHistory&gt; roomHistoryList = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L83">    @OneToMany(mappedBy = &quot;user&quot;)</span>
<span class="nc" id="L84">    private List&lt;Room&gt; roomList = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L86">    @OneToMany(mappedBy = &quot;user&quot;)</span>
<span class="nc" id="L87">    private List&lt;UserInterest&gt; userInterestList = new ArrayList&lt;&gt;();</span>

    private void defaultUserSettings() {
        try{
<span class="nc" id="L91">            userNickname = makeRandomNickname();</span>
<span class="nc" id="L92">        }catch (IOException e){</span>
<span class="nc" id="L93">            throw new NicknameFailException(NicknameFailException.MAKE_FAIL);</span>
<span class="nc" id="L94">        }</span>
<span class="nc" id="L95">        userPopularity = 0;</span>
<span class="nc" id="L96">        userPopularityLimit = 5;</span>
<span class="nc" id="L97">        userDeleted = YN.N;</span>
<span class="nc" id="L98">        userPoint = 0L;</span>
<span class="nc" id="L99">        userSoju = 0;</span>
<span class="nc" id="L100">        userBeer = 0;</span>

<span class="nc" id="L102">    }</span>

    // 로컬 회원가입
    // 이메일 비밀번호 이름 생년월일
    public static User createUser(String userName, String userPw, String userFullname, String userBirthday, String userEmail) {
<span class="nc" id="L107">        User user = new User();</span>
<span class="nc" id="L108">        user.defaultUserSettings();</span>
<span class="nc" id="L109">        user.userName = userName;</span>
<span class="nc" id="L110">        user.userPw = userPw;</span>
<span class="nc" id="L111">        user.userFullname = userFullname;</span>
<span class="nc" id="L112">        user.userBirthday = userBirthday;</span>
<span class="nc" id="L113">        user.userEmail = userEmail;</span>
<span class="nc" id="L114">        user.userRole = UserRole.ROLE_USER;</span>
<span class="nc" id="L115">        user.userProvider = UserProvider.local;</span>
<span class="nc" id="L116">        return user;</span>
    }

    // 소셜 회원가입
    public static User createUser(UserProvider userProvider, String userProviderId, String userName, String userEmail) {
<span class="nc" id="L121">        User user = new User();</span>
<span class="nc" id="L122">        user.defaultUserSettings();</span>
<span class="nc" id="L123">        user.userRole = UserRole.ROLE_SOCIAL;</span>
<span class="nc" id="L124">        user.userPw = null;</span>
<span class="nc" id="L125">        user.userProvider = userProvider;</span>
<span class="nc" id="L126">        user.userProviderId = userProviderId;</span>
<span class="nc" id="L127">        user.userName = userName;</span>
<span class="nc" id="L128">        user.userEmail = userEmail;</span>
<span class="nc" id="L129">        return user;</span>
    }

    // 회원수정
    // 닉네임 주량 자기소개
    public void updateUser(String userNickname, String userIntroduce, Integer userSoju, Integer userBeer, String userImg) {
<span class="nc" id="L135">        this.userNickname = userNickname;</span>
<span class="nc" id="L136">        this.userIntroduce = userIntroduce;</span>
<span class="nc" id="L137">        this.userSoju = userSoju;</span>
<span class="nc" id="L138">        this.userBeer = userBeer;</span>
<span class="nc" id="L139">        this.userImg = userImg;</span>
<span class="nc" id="L140">    }</span>

    //비밀번호 수정
    public void updateUserPassword(String userPw) {
<span class="nc" id="L144">        this.userPw = userPw;</span>
<span class="nc" id="L145">    }</span>

    //인기도 수정
    public void updatePopularity(Integer popularNum){
<span class="nc" id="L149">        this.userPopularity += popularNum;</span>
<span class="nc" id="L150">    }</span>

    //인기도 제한횟수 수정
    public void updatePopularityLimit(){
<span class="nc" id="L154">        this.userPopularityLimit -= 1;</span>
<span class="nc" id="L155">    }</span>

    // 닉네임 랜덤 생성
    public static String makeRandomNickname() throws IOException {
<span class="nc" id="L159">        URL url = new URL(&quot;https://nickname.hwanmoo.kr/?format=json&amp;count=1&amp;max_length=12&quot;);</span>

<span class="nc" id="L161">        HttpURLConnection conn = (HttpURLConnection) url.openConnection();</span>
<span class="nc" id="L162">        conn.setRequestMethod(&quot;GET&quot;);</span>
<span class="nc" id="L163">        conn.setRequestProperty(&quot;Content-type&quot;, &quot;application/json&quot;);</span>
<span class="nc" id="L164">        conn.setConnectTimeout(5000);</span>
<span class="nc" id="L165">        conn.setReadTimeout(3000);</span>

        BufferedReader rd;
<span class="nc bnc" id="L168" title="All 2 branches missed.">        if(conn.getResponseCode() == HttpURLConnection.HTTP_OK) {</span>
<span class="nc" id="L169">            rd = new BufferedReader(new InputStreamReader(conn.getInputStream(), &quot;UTF-8&quot;));</span>
        } else {
<span class="nc" id="L171">            rd = new BufferedReader(new InputStreamReader(conn.getErrorStream()));</span>
        }

<span class="nc" id="L174">        StringBuilder sb = new StringBuilder();</span>
        String line;
<span class="nc bnc" id="L176" title="All 2 branches missed.">        while ((line = rd.readLine()) != null) {</span>
<span class="nc" id="L177">            sb.append(line);</span>
        }

<span class="nc" id="L180">        rd.close();</span>
<span class="nc" id="L181">        conn.disconnect();</span>
<span class="nc" id="L182">        String word = (String) new JSONObject(sb.toString())</span>
<span class="nc" id="L183">                .getJSONArray(&quot;words&quot;).get(0);</span>
<span class="nc" id="L184">        return word;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>